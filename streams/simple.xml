<?xml version="1.0" encoding="UTF-8"?>
<joins>
	<mongodb.sink name="replication">
		<sink collection="Actor" topic="DVDS-actor"/>
		<sink collection="Film" topic="@FilmWithCategory"/>
		<sink collection="Rental" topic="DVDS-rental"/>
		<sink collection="Inventory" topic="DVDS-inventory"/>
	</mongodb.sink>

	<elasticsearch.sink name="elastic">
		<sink index="Actor" topic="DVDS-actor" type="Actor"/>
		<sink index="Film" topic="@FilmWithCategory" type="Film"/>
	</elasticsearch.sink>
<!-- 	
	<neo4j.sink>
		<sink database="@DVD" topic="DVDS-actor" labels="Actor" type="node"/>
		<sink database="@DVD" topic="DVDS-film" labels="Film" type="node"/>
		<sink database="@DVD" topic="DVDS-film_actor" labels="FEATURES" type="relation" fromLabel="Film" toLabel="Actor" fromId="film_id" toId="actor_id"/>
		<sink database="@DVD" topic="DVDS-film_category" labels="IS_CATEGORY" type="relation" fromLabel="Film" toLabel="Category" fromId="film_id" toId="category_id"/>
	</neo4j.sink>
	 -->
	<direct>

		<groupedStore name="filmactorbyactor" from="DVDS-film_actor" key="actor_id"/>
 		<joinGrouped name="filmactorwithactor" from="filmactorbyactor" with="DVDS-actor" into="Actor" optional="true" to="@FilmActorWithActor"/>

		<groupedStore name="categorybycategory" from="DVDS-film_category" key="category_id"/>
 		<joinGrouped name="categorywithcategory" from="categorybycategory" with="DVDS-category" into="Category" optional="false" to="@Category"/>

		<groupedStore name="filmactorbyfilm" from="filmactorwithactor" key="film_id"/>
		<join name="filmactorwithfilm" from="DVDS-film" withList="filmactorbyfilm" into="Actors" optional="true"/>

		<groupedStore name="categorybyfilm" from="categorywithcategory" key="film_id"/>
 		<joinGrouped name="filmwithcategory" from="filmactorwithfilm" with="categorybyfilm" into="Category" optional="true" to="@FilmWithCategory"/>

	</direct>
</joins>